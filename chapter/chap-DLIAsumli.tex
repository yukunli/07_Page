\chapter{数字锁相放大器的设计和仿真}
本课题中的光电探测器接收到的光信号十分微弱，因此其输出的电信号是淹没在强噪声背景下的微弱信号，信号检测电路放大被测信号的同时也放大了噪声，并且引入其他的噪声进来，例如放大器内部的固有噪声和各种外部噪声，所以只靠放大技术是不能有效地把微弱信号检测出来。而基于相关检测原理构建的锁相放大器是目前应用最为广泛的微弱信号检测方法。

本章将详细介绍锁相放大器的相关原理，并根据其原理建立数字锁相放大器的~Python~仿真模型，通过使用~Python~对相敏检波过程进行仿真，找到适合本课题的最佳的数字信号采样频率和最合适的采样数据长度等参数，为之后章节的~DSP~软件设计提供必要的理论依据。

\section{微弱信号检测技术理论}

\subsection{微弱信号检测}
我们日常生活环境中的噪声和干扰无处不在，各种各样的噪声和干扰分布范围及其广泛。微弱信号检测就是将淹没在强噪声背景下的微弱信号，通过一定的检测手段，在有效地抑制噪声的条件下放大微弱信号的幅度，提取有用的信号。微弱信号的检测方法很多，它们有各自的特点及使用范围。目前主要方法有：

（1）取样积分法：取样积分原理是对待测的重复信号进行逐点多次取样，并进行同步积从噪声中恢复信号波形分方法。该方法是处理周期已知的周期性重复信号的一种有效方法\upcite{}。

（2）同步累积法： 该方法基于噪声的随机性和信号的稳定性。信号在多次重复的情况下，接收端会收到不同的畸变信号，因为信号具有周期重复性，而噪声没有这种性质，因此每个周期信号所受到的干扰不同。而同步累积法指对周期信号的固定点，周期重复测量，并将所测量的值累加以使信号幅度越积越大，噪声累积后因自身的随机性可部分抵消，信号重复的次数越多，输出的信号便越接近原信号，从而越能大幅的提高信噪比\upcite{}。

（3）相关检测法：相关方法是根据周期信号的幅度在不同时刻具有相关性，而噪声是随机的，无相关性，利用这种周期信号间的相关性及噪声与周期信号的不相关性，将周期洗好从强噪声中提取出来的方法。该方法分为自相关和互相关两种，而互相关法由于能够抑制与参考信号不相关的各种形式的噪声而显示出其在噪声抑制能力上由于自相关的特性\upcite{}。

（4）小波变换法：小波变换是一种多分辨分析的方法，可同时进行时域和频域的分析，从而可以有效提取强噪声背景下的微弱信号\upcite{}。

（5）混沌振子法：混沌振子法是基于混沌理论的、利用混沌振子对同频信号具有极强的敏感性却对噪声具有极强的免疫力而实现的微弱信号检测法，是利用噪声而非消除噪声以达到信号检测的目的。

（6）光子计数技术:光子计数技术是一种探测灵敏度、分辨率极高,且具有长时间稳定性的微弱信号检测方法。单个光子会在光电倍增管中激发出光电子脉冲，该项技术就是通过分辨这些脉冲从而将光信号以数字化的方式提取出的。适用于传统的锁相技术和取样积分技术无法检测的超微弱光的情况下表现出量子性的光信号检测\upcite{}。

在这些方法中，相关方法是使用得最为广泛，被认为是最有效的一种方法，而近几年兴起的锁相放大器既是基于相关方法发展起来的检测微弱信号的有效仪器。

\subsection{信噪改善比}
微弱信号检测方法众多，在具体检测过程中，需根据不同信号，及不同的检测要求，并根据不同的条件来选择不同的测量方法。但其宗旨均为抑制噪声，恢复、增强和提取有用信号，即提高信噪改善比(SNIR)。 信号通过一个放大器或者一个测试系统，若信噪比得到改善，其数量关系式用信噪改善比来衡量的，其定义为
\begin{equation}\label{3.1}
SNIR =\frac{S_{o}/N_{o}}{S_{i}/N_{i}}
\end{equation}
式中，$S_{o}/N_{o}$为输出信噪比，$S_{i}/N_{i}$为输入信噪比。

对白噪声而言，噪声电压正比于噪声带宽的平方根，因此，当系统为单位增益(即$S$)时,信噪改善比又可表示为
\begin{equation}\label{3.2}
SNIR =\frac{S_{o}/N_{o}}{S_{i}/N_{i}} = \sqrt{\frac{\Delta f_{N_{i}}}{\Delta f_{N_{o}}}}
\end{equation}
式中，$\Delta f_{N_{i}}$为系统输入噪声带宽，$\Delta f_{N_{o}}$为系统输出噪声带宽。

由式可知，输出噪声带宽越窄，则信噪改善越有效。因此，为提高信噪比，在保证有用信号必要的通频带的前提下，将系统的带宽做的越窄越好。


\section{锁相放大器}
锁相放大器，是以相关检测技术为基础，利用参考洗好频率与带擦而信号频率相关，与噪声不相关的特性，进而从较强的噪声背景中提取出有用信号的一种装置\upcite{}。它以某参考信号作为比较的基准，该参考信号的频率和相位是与待测信号相同的。该参考信号只与被测信号、及与它自身同频(或倍频)、同相的噪声分量相关，而与大部分噪声不相关，从而能极大的抑制噪声，提高检测信噪比。故而使其成为一种有效的微弱信号检测装置。

锁相放大器一般分为模拟锁相放大器(ALIA)和数字锁相放大器(DLIA)。ALIA一般是用相敏检波器(开关式乘法器)和低通滤波器来实现模拟相敏检波。即输入信号与参考信号分别通过信号通道和参考通道，然后进入相敏检波器(或称解调器)，做乘法解调，然后经过低通滤波器滤除交流分量并将最后的检测结果输出。DLL气是将ALL气中的核心相敏检波器由DSP或微处理器内部编程实现，来进行数字解调运算进而输出检测结果。

\subsection{模拟锁相放大器基本原理}
模拟锁相放大器的原理框图如图~\ref{fig1}~所示，从图中可以看出一般模拟锁相放大器组成分为信号通道，参考通道和相关器三部分。
\begin{figure*}[!h]
\centering
\includegraphics[width=15cm]{fig30.png}
\caption {典型的模拟锁相放大器原理图}
\addtocounter{figure}{-1}
\renewcommand\figurename{Fig.}
\caption{\label{fig1}Schematic diagram of a typical analog lock-in amplifier}
\end{figure*}

信号通道的作用是将弱信号进行放大，使其与相关器工作的电平范围相匹配，同时抑制和滤除干扰及噪声，从而扩大仪器的动态范围。信号通道需满足低噪声、高增益的特点。锁相放大器中需要参考信号进行相关运算，参考信号是和待测信号同步的对称方波或正弦波，通常参考通道对参考信号进行幅值和相位的调整，使其达到相敏检测器对输入信号的要求。相关器是一种完成被测信号与参考信号互相关函数运算的电子线路，包括乘法器和积分器两部分。其中乘法器选用开关式乘法器（即相敏检波器），积分器采用运算放大器组成的近似积分器，通常由低通滤波器构成。

本文对被测信号和参考信号均是正弦波进行理论阐述，设待测信号为
\begin{equation}\label{s1}
  V_{x}(t)=x(t)+n(t)=Asin(\omega_{x}t+\varphi_{x})+n(t)
\end{equation}


其中~$x(t)$~为待测信号中的有用信号，$n(t)$~为噪声。

参考信号为
\begin{equation}\label{s2}
  V_{r}(t)=Bsin(\omega_{r}(t)+\varphi_{r})
\end{equation}

模拟乘法器型相敏检波器的输出~$u_{p}(t)$~是两路信号的乘积，即
\begin{equation}\label{s3}
  V_{i}(t)=V_{x}(t) \cdot V_{r}(t)
\end{equation}

再经过积分器积分后的输出信号为
\begin{equation}\label{s4}
\begin{split}
  V_{o}(t) & = \lim_{T\rightarrow\infty}\frac{1}{2T}\int^{T}_{-T}[V_{x}(t)+n(t)] \cdot V_{r}(t)dt \\
   & = \lim_{T\rightarrow\infty}\frac{1}{2T}[\int^{T}_{-T}V_{x}(t)V_{r}(t)dt+\int^{T}_{-T}n(t)V_{r}(t)dt]  \\
   & = R_{xr}+R_{nr}
\end{split}
\end{equation}

上式中~$R_xr{}$、$R_{nr}$~分别表示待测有用信号与参考信号及噪声与参考信号之间的相关函数。由于噪声是随机的，与参考信号无相关性，因此它们之间的互相关函数~$R_{nr}$~经过长时间的积分后结果为零。但实际计算过程中积分时间不可能无限长故~$R_{nr}$~不可能为零，这些剩余的噪声对测量结果影响很小，故可近似认为~$R_{nr}$~项为零。

其中~$R_{xr}$~为
\begin{equation}\label{s5}
\begin{split}
  R_{xr}&=\lim_{T\rightarrow\infty}\frac{1}{2T}[\int^{T}_{-T}V_{x}(t)V_{r}(t)dt \\
  &=\lim_{T\rightarrow\infty}\frac{1}{2T}\int^{T}_{-T}\{\frac{1}{2}ABcos[(\omega_{x}+\omega_{r})t+(\varphi_{x}+\varphi)_{r}]\\
  &-\frac{1}{2}ABcos[(\omega_{x}-\omega_{r})t+(\varphi_{x}-\varphi)_{r}]\}dt
\end{split}
\end{equation}
当~$\omega_{x}=\omega_{r}$~时，且噪声相关函数~$R_{nr}$~为零时，积分器输出的信号~$u_{0}$~为
\begin{equation}\label{s6}
  u_{0}=\frac{AB}{2}cos\theta
\end{equation}

式中，$\theta$~为待测信号与参考信号的相位差。

由式~\ref{s6}~表明，在参考信号为正弦波的情况下，经过相关检测后，其输出结果不仅与被测信号的幅值和参考信号的幅值有关，还与两信号的相位差有关。当输入的被测信号~$V_{x}(t)$~与参考信号~$V_{r}(t)$~频率相同时，画出以相位差~$\theta$~ 为自变量，$u_{0}(\theta)$为因变量的相敏特性曲线如图~\ref{fig2}~所示。当被测信号与参考信号相位差~$\theta=0$~时，输出信号~$u_{0}(\theta)$~的幅值最大。
\begin{figure*}[!h]
\centering
\includegraphics[width=8cm]{fig31.png}
\caption {相敏特性曲线}
\addtocounter{figure}{-1}
\renewcommand\figurename{Fig.}
\caption{\label{fig2}The curve of the phase sensitive properties}
\end{figure*}

\subsection{正交矢量型锁相放大器基本原理}
锁相放大器虽然可以很好的检测强噪声背景中的微弱信号，但却对参考信号的相位有着严格的要求。待测信号和参考信号的相位差为~$0^{o}$~时锁相放大器的直流输出信号才能真实地反映实际信号的变化，而在实际的应用中，要是两者之间的相位差为~$0^{o}$~时相当困难的。基于上诉原因，使用两个相敏检波器组成正交矢量锁相放大器可以很好地避免相位差对测量结果的影响，以获得更好的信噪改善比。

正交矢量锁相放大器采用了两个工作原理完全相同的相敏检波器用以同时给出正交分量和同相分量以做矢量运算。图~\ref{fig2}~为正交矢量锁相放大器结构图。
\begin{figure*}[!h]
\centering
\includegraphics[width=15cm]{fig32.png}
\caption {正交矢量锁相放大器结构图}
\addtocounter{figure}{-1}
\renewcommand\figurename{Fig.}
\caption{\label{fig2}Schematic diagram of orthogonal lock-in-amplifier}
\end{figure*}

参考通道通过移相器产生相互成正交，即相位差为~$90^{o}$~的两个参考信号，分别与被测信号进入不同的相敏检测器进行互相关运算，运算结果分别通过两个低通滤波器滤除高频分量，得到两个差频分量：
\begin{equation}\label{s6}
  X=\frac{1}{2}Acos\theta
\end{equation}
\begin{equation}\label{s7}
  Y=\frac{1}{2}Asin\theta
\end{equation}

式~\ref{s6}~和式~\ref{s7}~中，$X$~和~$Y$~分别为锁相放大器输出的同相分量和正交分量。

同相分量与正交分量经过如下运算便可得到有用信号的幅值和相位信息：
\begin{equation}\label{s8}
  V_{o} = 2\sqrt{X^{2}+Y^{2}}
\end{equation}
\begin{equation}\label{s9}
  \theta=\arctan(Y/X)
\end{equation}

式~\ref{s8}~和式~\ref{s9}~中，$V_{o}$~和~$\theta$~分别为被测信号的幅值和相位。正交锁相型放大器能直观动态地检测出幅值和相位，相位差~$\varphi$~ 的改变不影响测量的幅值变化，即幅值~$V_{o}$~的输出不是相敏的。因此可以更为准确测出被测信号幅值的大小。

正交矢量锁相放大器能同时获得被测信号的幅值和相位信息，从而实现矢量测定。此外还能够有效克服单路锁相放大器由相位差所产生的误差而影响幅度测量精度的问题。

\subsection{数字锁相放大器基本原理}
数字锁相放大器是以模拟锁相放大器和正交矢量锁相放大器为理论基础，核心相敏检波器和低通滤波器均采用数字微处理代替的新型锁相放大器。其结构如图~\ref{fig3}~所示。
\begin{figure*}[!h]
\centering
\includegraphics[width=15cm]{fig33.png}
\caption {数字锁相放大器原理图}
\addtocounter{figure}{-1}
\renewcommand\figurename{Fig.}
\caption{\label{fig3}Digital lock-in amplifier schematic diagram}
\end{figure*}

由图~\ref{fig3}~可以看出，待测信号首先进入信号通道，该通道与基本的锁相放大器的信号通道功能相同，实现对待测信号的放大、滤波等信号预处理。在获得满足~$A/D$~分辨率要求的待测信号后经过~$A/D$~芯片采样得到离散的信号序列，然后输入到微处理器中进行数字互相关运算。而参与运算的参考信号也有微处理内部产生，在微处理内部进行正交矢量锁相器的相关运算后即可获得待测的有用信号。

基于上诉数字锁相放大器原理，设待测信号为：
\begin{equation}\label{s10}
  x(k)=Asin(2\pi ft+\theta)+n(t)
\end{equation}

式~$\ref{s10}$~中，$f$~为输入信号频率，设采样频率为~$f_{s}$~,如果~$f_{s}=Nf(n\geq3)$，则采样间隔~$\tau=1/(Nf)$。 由于有用信号和噪声之间没有相关性，故将待测信号中的噪声~$n(t)$~不予考虑。为建立简洁有效的互相关运算，随信号进行整周期采样。如果整周期采样点数为~$M$~, 则对输入信号采样得到的信号序列为：
\begin{equation}\label{s11}
  x(k)==Asin(2k\pi /N)~~~~(k=0,1,2...M-1)
\end{equation}

参考序列由微处理器产生，是与待测信号同频的正余弦序列：
\begin{equation}\label{s12}
\begin{split}
  r_{s}(k)&=sin(2k\pi /N) \\
  r_{s}(k)&=cos(2k\pi /N)~~~~(k=0,1,2...M-1)
\end{split}
\end{equation}

采样后的信号~$x(k)$~与正余弦参考序列分别做互相关运算，再经过数字低通滤波器之后，即得到同相输出和正交输出：
\begin{equation}\label{s13}
\begin{split}
  R_{xr,s}&=\frac{1}{M}\sum_{k=0}^{M-1}x(k)\cdot r_{s}(k)\approx\frac{A}{2}cos\theta \\
  R_{xr,c}&=\frac{1}{M}\sum_{k=0}^{M-1}x(k)\cdot r_{c}(k)\approx\frac{A}{2}sin\theta
\end{split}
\end{equation}

进而计算得到待测信号的幅值和相位：
\begin{equation}\label{s14}
  A=2\sqrt{R^{2}_{xr,s}+R^{2}_{xr,c}}
\end{equation}
\begin{equation}\label{s15}
  \theta=\arctan(R_{xr,c}/R_{xr,s})
\end{equation}

当~$x(t)$~为~$M$~个采样点所构成的信号数组时，对于第~$j(j=0,1,2，...，M-1)$~个采样点，经过数字锁相放大器处理后，输出信号的幅值、相位分别为：
\begin{equation}\label{s16}
  A(i)=2\sqrt{R^{2}_{xr,s}(i)+R^{2}_{xr,c}(i)}
\end{equation}
\begin{equation}\label{s17}
  \theta(0)=\arctan(R^{2}_{xr,c}(i)/R^{2}_{xr,s}(i))
\end{equation}

上述即为数字锁相放大器核心算法原理，由微处理器的内部编程实现。
\subsection{数字LIA与模拟LIA的比较}
以上分别介绍了模拟锁相放大器和数字锁相放大器的典型结构及其核心算法原理，分析比较后可以看到数字锁相放大器逐步取代模拟锁相放大器的必然趋势，这是由模拟锁相放大器自身局限性和数字锁相放大器的优势所决定的。

在微弱信号检测技术发展之初，锁相放大器作为检测微弱信号的有效仪器做出了无法替代的贡献，使得检测强噪声背景下微弱信号技术得到了大幅提高，然而随着科学的发展，数字产品的诞生、高精度、高稳定性的要求的提高，模拟锁相放大器自身
的局限性越发的凸显出来：

（1）模拟电子器件构成的模拟锁相放大器会产生大量的系统噪声，其中的有源模拟，器件本身就是噪声源，而无源器件也会引进一部分噪声，这都将会对系统的性能造成一定的影响。

（2）对于模拟器件构成的核心相敏检波器，其线性影响着相关运算的精度。但这种线性不易保证、易饱和、且线性范围小、以致对系统的精度造成了很大程度的限制。而且高精度的乘法器结构复杂，设计困难\upcite{}。

（3）相敏检波后，积分过程中积分时间无限长时噪声可完全被抑制，但实际测量中，因电容自身的漏电现象，导致积分时间不可能无限长，进而使模拟锁相放大器对缓变周期信号的检测效果变差。

（4）模拟锁相放大器本身是一个开环系统，无法对干扰产生的误差进行纠正。

随着传统的模拟信号处理方法慢慢被数字信号处理方法所代替，模拟锁相放大器核心部件相敏检波器被数字化处理方法取代后才出现了全新意义上的数字锁相放大器。相比于模拟锁相放大器，数字锁相放大器有着诸多的优势所在。

（1）数字锁相放大器因其核心电路被~DSP~或微处理器所取代，从而在电路设计上得到了极大程度的简化。

（2）大量模拟电路被数字化微处理器替代后，轻松的克服了因模拟器件自身影响所产生的诸如谐波抑制能力差，直流漂移等问题。

（3）核心的相关算法是由软件编程所实现，因此调试方便，灵活性好。且能够根据数字相关器的处理结果实时的计算出信号的有效幅值、相位角。并实现自动调节增益、自动改变参考信号相位等功能\upcite{}。

基于以上数字锁相放大器的优点，本课题采用数字锁相放大器的方法实现微弱信号的检测，在极大的简化电路设计的同时，有效提高了信号的信噪改善比。在数字锁相放大器的应用中，采样频率、数据长度等关键参数的设计对运算性能有直接影响，因此本文将在下一小节中对算法及多种参数设计进行仿真和分析。

\section{数字锁相放大器仿真平台的设计和仿真}

在数字锁相放大器算法中，采样频率、采样数据长度是决定数字锁相放大器处理效果的关键参数。而这些参数的设计需要综合输入信号的频率、信噪比、幅值、波形等多项因素进行考虑。本文建立了基于~Python~的算法仿真平台对该算法进行一系列的测试，从而完成对所需参数的选择，为后面章节的嵌入式软件设计提供理论依据。
\subsection{仿真平台的设计}
Python~是一种面向对象的、动态的程序设计语言。具有非常简洁而清晰的语法，适合于完成各种高层任务。它既可以用来快速开发程序脚本，也可以用来开发大规模的软件。随着~NumPy、SciPy、Matplotlib、Enthought librarys~等众多程序库的开发，Python~越来越适合于做科学计算、绘制高质量的~2D~和~3D~图像。和科学计算领域最流行的商业软件~MATLAB~相比，Python~是一门通用的程序设计语言，比~MATLAB~所采用的脚本语言的应用范围更广泛，有更多的程序库的支持。适用于~Windows~和~Linux~等多种平台，完全免费并且开放源码。

本文以~Python~作为开发工具，设计了数字锁相放大算法的测试程序，以验证数字锁相放大器在本课题中微弱信号的检测的能力以及进行参数的合理选择。图~\ref{fig4}~所示是~Python~的数字锁相放大算法流程图。

\begin{figure*}[!h]
\centering
\includegraphics[width=4cm]{fig34.pdf}
\caption {数字锁相放大算法流程图}
\addtocounter{figure}{-1}
\renewcommand\figurename{Fig.}
\caption{\label{fig4}Flow chart of digital phase locked loop}
\end{figure*}

为了真实的反映数字锁相放大器在本课题中处理微弱信号的效果，Python~仿真平台调用了~numpy、matplotlib、math、random~等程序库。其中，numpy~专门为进行严格的数字处理而产生，提供了许多高级的数字编程工具，如快速数组处理、数值运算以及大量的时域频域信号分析模块等。matplotlib~不仅通过~Python~提供了一套和~MATLAB~类似的绘图~API，将众多绘图对象所构成的复杂结构隐藏在这套~API~内部。而~random~库用于提供随机噪声的产生。通过该仿真平台可以很方便的完成被测信号以及算法参数的输入，同时将运行结果以图形的形式给出。

数字锁相放大算法的主要性能指标主要有测量精度和频率分辨能力，由文献\cite{8}可知，要提高数字锁相放大器的测量精度和频率分辨能力，应加大总的测量时间。但在测量时间一定的情况下，要加大数据长度就需要提高信号采样频率，而提高了信号采样频率会使数字相关运算的时间减小，所以合理的选择采样频率和采样点数是非常重要的。

\subsection{仿真结果与分析}
本课题中，根据探测器接收到的信号的频率本文以待测信号为~$5kHz$~为例进行仿真。根据奈奎斯特定理，采样频率必须大于２倍的待测信号的频率。为了避免由非周期采样给数字锁相结果带来误差，应尽量使采样频率与待测信号的频率的比值为一个整数。
%而考虑到噪声是宽带的，为了避免~$f_{s}$~频率以上的噪声通过~$A/D$~后引起混叠现象，

本文给定如下条件：待测信号中有用信号的频率为~$5kHz$，信号幅值为~$0.1V$，叠加的随机噪声均值为~$0$~，方差为~$0.01$~，即输入信号的信噪比为~$-30dB$~。在~$100kHz$~的采样周期下采集~$480$~个点，得到如下图~\ref{fig5}~所示的待测信号时域、频域的信号图。
\begin{figure*}[!h]
\centering
\includegraphics[width=15cm]{fig35_2.png}
\caption {待测信号的正弦时域信号和频谱}
\addtocounter{figure}{-1}
\renewcommand\figurename{Fig.}
\caption{\label{fig5}Sinusoidal time domain signal and frequency spectrum of the measured signal}
\end{figure*}

将设定条件下的待测信号与参考信号经过数字相敏检波和数字滤波器后，可得到相关运算后的同相分量和正交分量。图~\ref{fig6}~给出了同相分量和正交分量的信号频谱，可以看出输出信号的信噪比有了很大的改善。

\begin{figure*}[!h]
\centering
\includegraphics[width=14cm]{fig36.png}
\caption {相关运算后同相分量和正交分量的信号频谱}
\addtocounter{figure}{-1}
\renewcommand\figurename{Fig.}
\caption{\label{fig6}Signal spectrum of the phase component and quadrature component of the correlation operation}
\end{figure*}

\begin{figure*}[!h]
\centering
\includegraphics[width=14cm]{fig37.png}
\caption {相关运算后输出信号的幅值}
\addtocounter{figure}{-1}
\renewcommand\figurename{Fig.}
\caption{\label{fig7}The amplitude of the output signal after the correlation operation}
\end{figure*}

根据数字锁相放大器的原理，对同相分量和正交分量进行进一步计算，即可得到待测信号的幅值和相位。本课题不考虑信号相位信息，得到的输出信号的幅值信息如图~\ref{fig7}~所示。

在满足奈奎斯特采样定律的前提下，本文观察了在不同的采样频率（$20kHz$、$40kHz$、$50kHz$、$80kHz$、$100kHz$、$120kHz$、$150kHz$、$200kHz$）对锁相放大效果的影响。为了保证整周期采样，数据长度选择480 个点。表~\ref{table1}~分析输出信号的幅值均值及测量精度，图~\ref{fig8}~是不同采样频率下输出信号的幅值计算曲线。

\begin{table*}[!h]\tiny
\caption{不同采样频率下输出信号的幅值均值及测量精度}
\addtocounter{table}{-1}
\renewcommand\tablename{Table}
\caption{A verage amplitude and precision of output signal in different sampling frequency }
\label{table1}
\small
%\setlength\tabcolsep{2.8pt}
\renewcommand{\arraystretch}{1.5}
\centering
\begin{tabular}{cccccccccccccccccccc}
\\
\bottomrule
%           \cline{2-4}\cline{6-8}
$F_{s}(kHz)$  && $20$        && $40$         && $50$        && $80$        && $100$       && $120$       && $150$  && $200$\\ \hline

均值$(V)$    && $0.1034447$ && $0.0949647$  && $0.1028682$ && $0.1040957$ && $0.1010758$ && $0.0992312$ && $0.1004873$ && $0.0984369$ \\
精度$(\%)$   && $3.4448$    && $5.0353$     && $2.8682$    && $4.0958$    && $1.0759$    && $0.7687$    && $0.4873$  && $1.5630$\\
\bottomrule
\end{tabular}
\end{table*}

\begin{figure*}[!ht]
\centering
\includegraphics[width=14cm]{fig38_2.png}
\caption {不同采样频率下相关运算后输出信号的幅值}
\addtocounter{figure}{-1}
\renewcommand\figurename{Fig.}
\caption{\label{fig8}The amplitude of the output signal after the correlation operation in different sampling frequency}
\end{figure*}

从上面的图表中可以看出，采样频率对锁相放大效果有一定的影响，从信号幅值测量精度效果看，当采样频率为~$100kHz$、$120kHz$~和~$150kHz$~时输出信号的精度较高。本课题所涉及到的待测信号的频率分别为~$4kHz$、$5kHz$~和~$6kHz$~，为了保证这三路不同频率的待测信号都能取得较好的锁相放大效果，同时能够满足整周期采样的要求，本课题选择最佳的采样频率为~$120kHz$。

\begin{table*}[!ht]\tiny
\caption{不同数据长度下输出信号的幅值均值及测量精度}
\addtocounter{table}{-1}
\renewcommand\tablename{Table}
\caption{A verage amplitude and precision of output signal in different length of the sampling data }
\label{table2}
\small
%\setlength\tabcolsep{2.8pt}
\renewcommand{\arraystretch}{1.5}
\centering
\begin{tabular}{ccccccccccccccccccccccc}
\\
\bottomrule
%           \cline{2-4}\cline{6-8}
采样点数  && $100$        && $200$         && $300$        && $400$        && $600$       && $800$   && $1000$\\ \hline

均值$(V)$ && $0.1063462$ && $0.0946147$  && $0.0960384$ && $0.1008084$ && $0.1005055$ && $0.1004940$ && $0.0996951$\\
精度$(\%)$&& $6.3462$    && $5.3853$     && $3.9616$    && $0.8084$    && $0.5055$    && $0.4940$    && $0.3049$\\

\bottomrule
\end{tabular}
\end{table*}

接下来，本文研究了不同数据长度（即采样点数）对锁相放大效果的影响。从表~\ref{table2}~中可以发现，随着采样点数的增加，数字锁相放大器算法的测量精度也有了显著提高，但随之带来计算时间也会增长。在实时性要求较高的场合，需要兼顾速度和精度，选取适当的采样点数。考虑到本课题对运算速度和精度的要求，选取采样点数为~420~作为待测信号序列的长度，这样既可以保证三路不同频率的信号均能采集到整周期的信号，也能在满足精度要求的同时不会影响计算时间。


\section{小结}
本章研究了微弱信号的几种检测方法，并针对相关检测法作了详细的阐述，特别是对模拟锁相放大器、正交矢量型锁相放大器和数字锁相放大器的基本原理做了深入的研究。通过对比模拟模拟锁相放大器和数字锁相放大器的优缺点，本文选择了高信噪改善比、设计简单、调试方便、灵活性好的数字锁相放大器实现微弱信号的检测。由于采样频率和数据长度参数的设计对数字锁相放大器的性能有关键性的影响，本文建立了基于~Python~的仿真平台对该算法进行一系列的测试。通过对该算法及采样频率和数据长度两个关键参数的仿真和分析，并结合本课题实际的软硬件要求，本章选取了最佳的采样频率和最合适的采样长度，为后面章节的软硬件设计提供了理论依据。其中，数字锁相放大器的信号通道的硬件实现将在第~\ref{x}~章节说明，而其在DSP 系统中的软件实现将在第~\ref{y}~章节中进行详细说明。













